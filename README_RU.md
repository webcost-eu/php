# Проект написан на codeigniter 3
<b>original</b> - изначальный код проекта
<br/><b>after_refactor</b> - результат оптимизации и доработки проекта

## Проблемы, которые были решены.
### 1.Права и роли
#### Было:
Права и роли были организованы разделением структуры проекта на соответствующие каталоги (admin, agent, consultant, solicitor). Из-за этого было много дублированного кода, что затрудняло внесение правок в существующий код и написание новой функциональности. При добавлении новой роли необходимо было копировать соответствующий функционал, что влекло еще бОльшие временные затраты для дальнейшего обслуживания проекта
#### Сделано:
Создана функциональность, основанная на матрице принадлежности пользователя к роли и доступа роли к функциональности, которая позволяет внутри контрллера проверять роль и доступ к тем или иным функциям. Контрллеры (админ/чат,  агент/чат, админ/дашбоард, агент/дашбоард и др.) объеденены соответственно в чат, дашбоард и т.д. Тем самым убрано дублирование кода. Время на внесение правок и создание новой функциональности уменьшено в разы. При создании роли достаточно дать ей нужные права, а не копировать код.
### 2. Core back
#### Было:
Был единый контроллер, была универсальная модель для выборки данных. При внесении изменений и создании нового функционала они накапливали в себе лишний код, который был нужен в одном месте, но не нужен в другом. Файлы разрастались до больших размеров, что затрудняло их понимание.
#### Сделано:
Оптимизирован базовый контрллер, оптимизирована базовая модель. Созданы тематические контрллеры (agent, chat и т.д.), которые содержат только нужный для сущности код. Это  позволило сократить время на понимание функциональности и его обслуживание.
### 2. Core front
#### Было:
Каждая страница сайта содержала всю HTML разметку. Так же было много js скриптов прямо в разметке. Дублирование html для каждой роли, как и для контрллера. html разметка встречалась и в коде php. Для внесения правок требовалось исправлять очень много файлов, что влекло очень большие временные затраты. 
#### Сделано:
Создан каркас шаблона. Все однотипные шаблоны сведены в один. Добавлено разграничение по ролям. html hазбит на логические части. Это помогло сократить время на правки шаблонов.

### 3. Локализация.
#### Было:
Поскольку клиент хотел иметь возможность редактировать тексты,то они хранились в базе данных. Часть текстов хранились прямо в коде (php и html), что недопустимо. Перевод текста осуществлялся через вспомогательную функцию с использованием индекса (translate(13)) из базы данных. Это затрудняло работу с с шаблонами и переводами. В следствии чего создавало много мусора в базе данных, а так же много дублированных данных"
#### Сделано:
Сделано согласование стандартных средств локализации и локализации налету. Данные можно редактировать, как на сайте, так и через стандартные средства. При чем приоритетными являются данные в базе данных. Т.е. при появлении новой метки в файлах перевода она добавляется в базу данных, а при изменении - нет.
### 4. работа с данными
#### Было:
Были нарушены принципы ООП. Хоть и был создан универсальный класс для работы с данными, но присутствовали запросы прямо в коде. Выборки были разбросаны по коду. Это вызывало трудности при внесении изменений в структуру БД, а так же в функциональность
### Сделано:
Создана базовая модель. Созданы тематические модели (chat, user, agent и др) предназначенные для работы с соответствующими данными. Добавлена работа с объектами. Код стал чище, читабельнее и понятнее. Уменьшено время на понимание и обслуживание кода.

### Что еще было сделано
- Добавлена стилизация темы (смена шрифтов, фона, цвета и т.д. через admin панель)
- Интеграция с google calendar
- Интеграция с SMSApi
- Проведена оптимизация БД (создание ключей, индексов)
